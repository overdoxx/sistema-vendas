<!DOCTYPE html>
<html lang="pt-BR" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %> - Gestão de Vendas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        dark: {
                            50: '#f8fafc',
                            100: '#f1f5f9',
                            200: '#e2e8f0',
                            300: '#cbd5e1',
                            400: '#94a3b8',
                            500: '#64748b',
                            600: '#475569',
                            700: '#334155',
                            800: '#1e293b',
                            900: '#0f172a',
                        }
                    }
                }
            }
        }
    </script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-gradient-to-br from-dark-900 via-dark-800 to-dark-900 min-h-screen">
    <!-- Mobile Menu Overlay -->
    <div id="mobile-menu-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden md:hidden" onclick="toggleMobileMenu()"></div>

    <!-- Mobile Menu Sidebar -->
    <div id="mobile-menu" class="fixed inset-y-0 left-0 w-64 bg-dark-800 border-r border-dark-700 z-50 transform -translate-x-full transition-transform duration-300 ease-in-out md:hidden">
        <div class="flex items-center justify-between p-4 border-b border-dark-700">
            <h1 class="text-xl font-bold text-white flex items-center">
                <div class="h-8 w-8 bg-gradient-to-r from-blue-600 to-purple-600 rounded-lg flex items-center justify-center mr-3">
                    <i class="fas fa-chart-line text-sm text-white"></i>
                </div>
                Gestão de Vendas
            </h1>
            <button onclick="toggleMobileMenu()" class="text-gray-400 hover:text-white focus:outline-none">
                <i class="fas fa-times text-xl"></i>
            </button>
        </div>
        <div class="px-2 pt-2 pb-3 space-y-1">
            <a href="/dashboard" class="text-gray-400 hover:text-white hover:bg-dark-700 block px-3 py-2 rounded-md text-base font-medium transition-colors">
                <i class="fas fa-tachometer-alt mr-2"></i>Dashboard
            </a>
            <a href="/sales/history" class="text-gray-400 hover:text-white hover:bg-dark-700 block px-3 py-2 rounded-md text-base font-medium transition-colors">
                <i class="fas fa-history mr-2"></i>Histórico
            </a>
            <a href="/top-sellers" class="text-white bg-dark-700 block px-3 py-2 rounded-md text-base font-medium">
                <i class="fas fa-trophy mr-2"></i>Top Vendedores
            </a>
            <div class="border-t border-dark-700 pt-4 pb-3">
                <div class="flex items-center px-3 mb-3">
                    <div class="h-8 w-8 bg-gradient-to-r from-green-500 to-blue-500 rounded-full flex items-center justify-center">
                        <i class="fas fa-user text-sm text-white"></i>
                    </div>
                    <span class="ml-3 text-sm text-gray-300">Olá, <span class="text-white font-medium"><%= user.name %></span></span>
                </div>
                <form action="/auth/logout" method="POST" class="px-3">
                    <button type="submit" class="text-gray-400 hover:text-red-400 text-sm transition-colors">
                        <i class="fas fa-sign-out-alt mr-1"></i>
                        Sair
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <nav class="bg-dark-800/80 backdrop-blur-sm shadow-xl border-b border-dark-700 sticky top-0 z-30">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <h1 class="text-xl font-bold text-white flex items-center">
                            <div class="h-8 w-8 bg-gradient-to-r from-blue-600 to-purple-600 rounded-lg flex items-center justify-center mr-3">
                                <i class="fas fa-chart-line text-sm text-white"></i>
                            </div>
                            Gestão de Vendas
                        </h1>
                    </div>
                    <div class="hidden md:ml-8 md:flex md:space-x-8">
                        <a href="/dashboard" class="text-gray-400 hover:text-blue-400 px-3 py-2 text-sm font-medium transition-colors">
                            <i class="fas fa-tachometer-alt mr-2"></i>Dashboard
                        </a>
                        <a href="/sales/history" class="text-gray-400 hover:text-blue-400 px-3 py-2 text-sm font-medium transition-colors">
                            <i class="fas fa-history mr-2"></i>Histórico
                        </a>
                        <a href="/top-sellers" class="text-white hover:text-blue-400 px-3 py-2 text-sm font-medium transition-colors border-b-2 border-blue-500">
                            <i class="fas fa-trophy mr-2"></i>Top Vendedores
                        </a>
                    </div>
                </div>
                
                <!-- Mobile menu button -->
                <div class="md:hidden flex items-center">
                    <button id="mobile-menu-button" onclick="toggleMobileMenu()" class="text-gray-400 hover:text-white focus:outline-none focus:text-white">
                        <i class="fas fa-bars text-xl"></i>
                    </button>
                </div>

                <div class="hidden md:flex items-center space-x-4">
                    <div class="flex items-center space-x-3">
                        <div class="h-8 w-8 bg-gradient-to-r from-green-500 to-blue-500 rounded-full flex items-center justify-center">
                            <i class="fas fa-user text-sm text-white"></i>
                        </div>
                        <span class="text-sm text-gray-300">Olá, <span class="text-white font-medium"><%= user.name %></span></span>
                    </div>
                    <form action="/auth/logout" method="POST" class="inline">
                        <button type="submit" class="text-gray-400 hover:text-red-400 text-sm transition-colors">
                            <i class="fas fa-sign-out-alt mr-1"></i>
                            Sair
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="py-6">
        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
            <!-- Header -->
            <div class="mb-8">
                <h1 class="text-3xl font-bold text-white mb-2">Top Vendedores do Mês</h1>
                <p class="text-gray-400">
                    <i class="fas fa-chart-line mr-2"></i>
                    Confira o desempenho de vendas de todos os vendedores este mês.
                </p>
            </div>

            <!-- Top Vendedores -->
            <div class="bg-dark-800 rounded-xl shadow-xl p-6 border border-dark-700">
                <h3 class="text-lg font-semibold text-white mb-6 flex items-center">
                    <div class="bg-yellow-600 rounded-lg p-2 mr-3">
                        <i class="fas fa-trophy text-white"></i>
                    </div>
                    Ranking de Vendas
                </h3>
                <div id="topSellersList" class="space-y-4">
                    <!-- Vendedores serão preenchidos via JS -->
                    <div class="flex items-center justify-center min-h-[100px]">
                        <i class="fas fa-spinner fa-spin text-3xl text-gray-400"></i>
                    </div>
                </div>
                <div id="topSellersTotal" class="mt-6 pt-4 border-t border-dark-700 text-right text-white text-lg font-bold">
                    <!-- Total geral será preenchido via JS -->
                </div>
            </div>
        </div>
    </main>

    <script>
    function toggleMobileMenu() {
        const mobileMenu = document.getElementById('mobile-menu');
        const overlay = document.getElementById('mobile-menu-overlay');
        mobileMenu.classList.toggle('-translate-x-full');
        overlay.classList.toggle('hidden');
    }

    // Função para formatar moeda (replicada do backend para uso no frontend)
    function formatCurrency(amount) {
        return new Intl.NumberFormat("pt-BR", {
            style: "currency",
            currency: "BRL",
        }).format(amount);
    }

    // Função para renderizar Top Vendedores
    async function loadTopSellers() {
        const topSellersList = document.getElementById('topSellersList');
        const topSellersTotal = document.getElementById('topSellersTotal');
        topSellersList.innerHTML = `
            <div class="flex items-center justify-center min-h-[100px]">
                <i class="fas fa-spinner fa-spin text-3xl text-gray-400"></i>
            </div>
        `;
        topSellersTotal.innerHTML = '';

        try {
            const response = await fetch('/top-sellers/api/data');
            if (!response.ok) {
                throw new Error('Erro ao carregar top vendedores.');
            }
            const data = await response.json();
            const sellers = data.sellers;
            const grandTotalSales = data.grandTotalSales;

            topSellersList.innerHTML = ''; // Limpar spinner

            if (sellers.length === 0) {
                topSellersList.innerHTML = '<p class="text-gray-400 text-center">Nenhum vendedor encontrado este mês.</p>';
                topSellersTotal.innerHTML = '';
                return;
            }

            sellers.forEach((seller, index) => {
                const sellerCard = `
                    <div class="flex items-center bg-dark-700 rounded-lg p-4 shadow-md">
                        <div class="flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center text-white font-bold text-lg mr-4
                            ${index === 0 ? 'bg-yellow-500' : index === 1 ? 'bg-gray-500' : index === 2 ? 'bg-amber-700' : 'bg-blue-600'}">
                            ${index + 1}
                        </div>
                        <div class="flex-grow">
                            <p class="text-white font-semibold">${seller.userName}</p>
                            <p class="text-gray-400 text-sm">${seller.salesCount} vendas</p>
                        </div>
                        <div class="text-right">
                            <p class="text-green-400 font-bold">${formatCurrency(seller.totalAmount)}</p>
                            <p class="text-blue-400 text-sm">Comissão: ${formatCurrency(seller.totalCommission)}</p>
                        </div>
                    </div>
                `;
                topSellersList.insertAdjacentHTML('beforeend', sellerCard);
            });

            topSellersTotal.innerHTML = `Total Geral: <span class="text-green-400">${formatCurrency(grandTotalSales)}</span>`;

        } catch (error) {
            console.error('Erro ao carregar top vendedores:', error);
            topSellersList.innerHTML = '<p class="text-red-400 text-center">Erro ao carregar top vendedores. Tente novamente.</p>';
            topSellersTotal.innerHTML = '';
        }
    }

    // Carregar top vendedores quando o DOM estiver pronto
    document.addEventListener('DOMContentLoaded', loadTopSellers);
    </script>
</body>
</html>
